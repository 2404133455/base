defvarp eventintime 0 250 $varidxmax
defvarp eventouttime 0 15000 $varidxmax
defvarp eventfadetime 0 500 $varidxmax
defvarp eventlines 0 10 $varidxmax
deffvarp eventblend 0 1 1

defsvarp claweventtex"<grey>textures/weapons/event/claw"
defsvarp pistoleventtex"<grey>textures/weapons/event/pistol"
defsvarp swordeventtex"<grey>textures/weapons/event/sword"
defsvarp shotguneventtex"<grey>textures/weapons/event/shotgun"
defsvarp smgeventtex"<grey>textures/weapons/event/smg"
defsvarp flamereventtex"<grey>textures/weapons/event/flamer"
defsvarp plasmaeventtex"<grey>textures/weapons/event/plasma"
defsvarp zappereventtex"<grey>textures/weapons/event/zapper"
defsvarp rifleeventtex"<grey>textures/weapons/event/rifle"
defsvarp grenadeeventtex"<grey>textures/weapons/event/grenade"
defsvarp mineeventtex"<grey>textures/weapons/event/mine"
defsvarp rocketeventtex"<grey>textures/weapons/event/rocket"
defsvarp meleeeventtex"<grey>textures/weapons/event/melee"

ui_hud_events = [
    local event_texth
    uiclip 0 0 0 0 [ uiclipforced 1; uitext "Dummy" $ui_texttiny [ event_texth = $uilasth ] ]
    uivlist 0 [
        uistyle lefttop
        loopevents (- $eventlines) 0 event_id [
            local event_time; event_time = (geteventmillis $event_id)
            local event_millis; event_millis = (- $totalmillis $event_time)
            local event_blend; event_blend = $eventblend
            local event_growth; event_growth = 1.0
            caseif (&& $eventouttime (> $event_millis $eventouttime)) [
                local event_ctime; event_ctime = (- $event_millis $eventouttime)
                if (&& $eventfadetime (< $event_ctime $eventfadetime)) [
                    event_growth = (-f 1 (divf $event_ctime $eventfadetime))
                    event_blend = (clampf (*f $event_growth $eventblend) 0 1)
                ] [ event_blend = 0 ]
            ] (&& $eventintime (< $event_millis $eventintime)) [
                event_growth = (divf $event_millis $eventintime)
                event_blend = (clampf (*f $event_growth $eventblend) 0 1)
            ]
            if (>f $event_blend 0.0) [
                local event_clients; event_clients = (geteventtaggroups $event_id "client")
                local event_colour; event_colour = 0
                loopwhile event_clidx $event_clients [! $event_colour] [
                    event_clientid = (geteventtag $event_id "client" $event_clidx "clientnum")
                    if (= $focusedplayer $event_clientid) [ event_colour = 0xFF202010 ]
                ]
                local event_obj
                event_obj = [
                    uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                    uitext (geteventlist $event_id "args" "console") $ui_texttiny [
                        uistyle leftmiddle
                        uitextalign -1
                        uicolourset (geteventlist $event_id "args" "colour")
                    ]
                ]
                local event_type; event_type = (geteventlist $event_id "args" "type")
                local event_action; event_action = (geteventlist $event_id "args" "action")
                if (= $showevents 2) [
                    cases $event_type "match" [
                        if (! $event_colour) [ event_colour = 0xFF102020 ]
                        cases $event_action "start" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (gamename $gamemode $mutators 0 64) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                    uicolourset $colouryellow
                                ]
                                uitext "on" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uitext (getmaptitle $mapname) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                    uicolourset $colourorange
                                ]
                            ]
                        ] "overtime" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Overtime" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_time; event_time = (geteventlist $event_id "args" "limit")
                                caseif (> $event_time 0) [
                                    uitext (concatword "Match extended ^fs^fc" (timestr $event_time $showtimestyle) "^fS") $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] (< $event_time 0) [
                                    uitext "Winner decided" $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] () [
                                    uitext "Next point wins" $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                            ]
                        ] "timelimit" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Time limit reached" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "oneminute" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "One minute remaining" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "scorelimit" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Score limit reached" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "scorereach" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Best score achieved" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ] "balance" [
                        if (! $event_colour) [ event_colour = 0xFF102020 ]
                        cases $event_action "warning" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (concatword "Team balance in ^fs^fc" (timestr (geteventlist $event_id "args" "millis") 4) "^fS") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "success" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Team balance ^fs^fccompleted^fS" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "failure" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Team balance ^fs^fcfailed^fS" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "lapse" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Team balance no longer required" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "unable" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "Team balance unable to be performed" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "swap" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_force; event_force = (geteventlist $event_id "args" "forcebal")
                                uitext (concatword (? $event_force "Role switch" "Symmetry swap") " in ^fs^fc" (timestr (geteventlist $event_id "args" "millis") 4) "^fS") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "swapped" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_force; event_force = (geteventlist $event_id "args" "forcebal")
                                uitext (concatword (? $event_force "Role switch" "Symmetry swap") " completed") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ] "team" [
                        if (! $event_colour) [ event_colour = 0xFF102020 ]
                        cases $event_action "request" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (concatword "Moved to " (getteamname (geteventlist $event_id "args" "team")) " as previously requested") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "moved" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (concatword "Moved to " (getteamname (geteventlist $event_id "args" "team")) " by " (geteventname $event_id "client" 1 3 0)) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "swap" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (concatword (geteventname $event_id "client" 0 3 0) " requests swap to " (getteamname (geteventlist $event_id "args" "team"))) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ] "frag" [
                        event_obj = [
                            uiimage $deadtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            local event_self; event_self = (= (geteventtag $event_id "client" 0 "clientnum") (geteventtag $event_id "client" 1 "clientnum"))
                            local event_extra; event_extra = 0
                            loopeventgroups $event_id "client" 0 0 event_client [
                                if $event_client [
                                    if $event_extra [
                                        uitext "+" $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                            uicolourset $colourgrey
                                        ]
                                    ]
                                    uitext (geteventname $event_id "client" $event_client 3 0) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        if $event_extra [ uicolourscale 0xA0A0A0 ]
                                    ]
                                    event_extra = 1
                                ]
                            ]
                            local event_weap; event_weap = (geteventlist $event_id "args" "weapon")
                            if (>= $event_weap 0) [
                                local event_weapon; event_weapon = (at $W_NAMES $event_weap)
                                uiimage $[@[event_weapon]eventtex] $[@[event_weapon]colour] 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ] [
                                if (geteventlist $event_id "args" "burning") [
                                    uiimage $burntex (getclientrescolour $focusedplayer $PULSE_BURN) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                ]
                                if (geteventlist $event_id "args" "bleeding") [
                                    uiimage $bleedtex (getclientrescolour $focusedplayer $PULSE_BLEED) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                ]
                                if (geteventlist $event_id "args" "shocking") [
                                    uiimage $shocktex (getclientrescolour $focusedplayer $PULSE_SHOCK) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                ]
                            ]
                            if $event_self [
                                uiimage $warningtex (getclientrescolour $focusedplayer $PULSE_WARN) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ] [
                                if (&& (! (& $mutators (<< 1 $G_M_FFA))) (= (geteventtag $event_id "client" 0 "team") (geteventtag $event_id "client" 1 "team"))) [
                                    uiimage $warningtex (getclientrescolour $focusedplayer $PULSE_WARN) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                ]
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ] "duel" [
                        if (! $event_colour) [ event_colour = 0xFF201020 ]
                        cases $event_action "start" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                if (&& (& $mutators (<< 1 $G_M_SURVIVOR)) (> $event_clients 4)) [
                                    uitext (concatword "Survivor with ^fs^fc" $event_clients "^fS players") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] [
                                    local event_extra; event_extra = 0
                                    loopeventgroups $event_id "client" 0 0 event_client [
                                        if $event_extra [
                                            uitext "vs." $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                                uicolourset $colourgrey
                                            ]
                                        ]
                                        uitext (geteventname $event_id "client" $event_client 3 0) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_desc; event_desc = (? (geteventlist $event_id "args" "sudden") "SUDDEN DEATH" (format "Round %1" (geteventlist $event_id "args" "round")))
                                uitext $event_desc $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "draw" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "All players fragged" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $deadtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext "EPIC FAIL" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "score" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                if (&& (& $mutators (<< 1 $G_M_SURVIVOR)) (! (& $mutators (<< 1 $G_M_FFA)))) [
                                    local event_team; event_team = (geteventlist $event_id "args" "winner")
                                    if (> (geteventtaggroups $event_id "alive") 4) [
                                        uitext (concat "Team" (getteamname $event_team)) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        uiimage $winnertex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                    ] [
                                        local event_extra; event_extra = 0
                                        loopeventgroups $event_id "alive" 0 0 event_client [
                                            if $event_extra [
                                                uitext "+" $ui_texttiny [
                                                    uistyle leftmiddle
                                                    uitextalign -1
                                                    uicolourset $colourgrey
                                                ]
                                            ]
                                            uitext (geteventname $event_id "alive" $event_client 3 0) $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                            ]
                                            event_extra = 1
                                        ]
                                        uiimage $winnertex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                    ]
                                ] [
                                    uitext (geteventname $event_id "alive" 0 3 0) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                    uiimage $winnertex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                ]
                                local event_dead; event_dead = (geteventtaggroups $event_id "dead")
                                if (> $event_dead 4) [
                                    uitext (concatword "^fs^fc" $event_dead "^fS / ^fs^fc" $event_clients "^fS fragged") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] [
                                    event_extra = 0
                                    loopeventgroups $event_id "dead" 0 0 event_client [
                                        if $event_extra [
                                            uitext "+" $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                            ]
                                        ]
                                        uitext (geteventname $event_id "dead" $event_client 3 0) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                if (! (& $mutators (<< 1 $G_M_INSTAGIB))) [
                                    local event_flawless; event_flawless = (geteventlist $event_id "args" "flawless")
                                    uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                    if $event_flawless [
                                        uitext "Flawless victory!" $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                    ] [
                                        local event_health; event_health = (divf (geteventlist $event_id "args" "health") $damagedivisor)
                                        if $damageinteger [ event_health = (toint (ceil $event_health)) ] [ event_health = (precf $event_health 1) ]
                                        uitext (concatword "^fs^fc" $event_health "^fS health left") $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                    ]
                                ]
                                local event_wins; event_wins = (geteventlist $event_id "args" "wins")
                                if (> $event_wins 1) [
                                    uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                    uitext (concatword "^fs^fc" $event_wins "^fS in row") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                            ]
                        ]
                    ] "bomber" [
                        if (! $event_colour) [ event_colour = 0xFF201020 ]
                        cases $event_action "secure" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $bombtakentex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "drop" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $bombdroptex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "score" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_goal; event_goal = (geteventlist $event_id "args" "goal")
                                local event_team; event_team = (getbomberteam $event_goal)
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "reset" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "start" [
                            event_obj = [
                                uiimage $modebombertex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ]
                    ] "capture" [
                        if (! $event_colour) [ event_colour = 0xFF201020 ]
                        cases $event_action "secure" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $flagtakentex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "return" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "drop" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $flagdroptex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "score" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                local event_goal; event_goal = (geteventlist $event_id "args" "goal")
                                local event_base; event_base = (getcaptureteam $event_goal)
                                uitext (geteventname $event_id "client" 0 3 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex (getteamcolour $event_base) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ] "reset" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex (getteamcolour $event_team) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                            ]
                        ]
                    ] "defend" [
                        if (! $event_colour) [ event_colour = 0xFF201020 ]
                        if (|| (=s $event_action "secure") (=s $event_action "overthrow")) [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                local event_extra; event_extra = 0
                                loop event_attackid $event_clients [
                                    if (= (geteventtag $event_id "client" $event_attackid "team") (geteventlist $event_id "args" (? (=s $event_action "secure") "owner" "enemy"))) [
                                        if $event_extra [
                                            uitext "+" $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                            ]
                                        ]
                                        uitext (geteventname $event_id "client" $event_attackid 3 0) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                uiimage $pointtex (getteamcolour (geteventlist $event_id "args" "oldowner")) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uiimage $pointtex (getteamcolour (geteventlist $event_id "args" "owner")) 0 0 $event_texth [ uistyle leftmiddle; uiimageaspect 1 ]
                                uitext (getdefendname (geteventlist $event_id "args" "affinity")) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ]
                ]
                uiclip 0 0 0 0 [
                    uistyle lefttop
                    uispace 0 $ui_padtiny [
                        uistyle lefttop
                        uiborderedimageclamped $skinalphatex (? $event_colour $event_colour 0xDD000000) 0 $ui_texborder $ui_screenborder 0 0 [
                            uistyle lefttop
                            local event_height
                            uispace $ui_padsmall $ui_padsmaller [
                                uistyle lefttop
                                uihlist $ui_padbutton [
                                    uistyle leftmiddle
                                    event_obj
                                ]
                            ]
                            uipropagate [ uicolourblend $event_blend ]
                        ]
                    ]
                    event_height = (+f $ui_padsmaller $ui_padsmaller $uilasthprev)
                    uiclipsizeh (*f $event_height $event_growth)
                ]
            ]
        ]
    ]
]