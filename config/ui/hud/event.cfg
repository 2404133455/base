defvarp eventintime 0 250 $varidxmax
defvarp eventouttime 0 15000 $varidxmax
defvarp eventfadetime 0 500 $varidxmax
defvarp eventlines 0 10 $varidxmax
deffvarp eventblend $fvaridxnonzero 1 1
defvarp eventobitclassic 0 0 1

defvarp eventskin 0 2 4
deffvarp eventskinblend 0.0 0.9 1.0
deffvarp eventskinspace 0 0.001 $fvaridxmax

defsvarp claweventtex "<grey><rotate:4>textures/weapons/claw"
defsvarp pistoleventtex "<grey><rotate:4>textures/weapons/pistol"
defsvarp swordeventtex "<grey><rotate:4>textures/weapons/sword"
defsvarp shotguneventtex "<grey><rotate:4>textures/weapons/shotgun"
defsvarp smgeventtex "<grey><rotate:4>textures/weapons/smg"
defsvarp flamereventtex "<grey><rotate:4>textures/weapons/flamer"
defsvarp plasmaeventtex "<grey><rotate:4>textures/weapons/plasma"
defsvarp zappereventtex "<grey><rotate:4>textures/weapons/zapper"
defsvarp rifleeventtex "<grey><rotate:4>textures/weapons/rifle"
defsvarp grenadeeventtex "<grey><rotate:4>textures/weapons/grenade"
defsvarp mineeventtex "<grey><rotate:4>textures/weapons/mine"
defsvarp rocketeventtex "<grey><rotate:4>textures/weapons/rocket"
defsvarp meleeeventtex "<grey><rotate:4>textures/weapons/melee"

ui_hud_events = [
    uivlist 0 [
        uistyle lefttop
        loopevents (- $eventlines) 0 event_id [
            local event_time; event_time = (geteventmillis $event_id)
            local event_millis; event_millis = (- $totalmillis $event_time)
            local event_blend; event_blend = $eventblend
            local event_growth; event_growth = 1.0
            local event_dir; event_dir = 0
            caseif (&& $eventouttime (> $event_millis $eventouttime)) [
                local event_ctime; event_ctime = (- $event_millis $eventouttime)
                if (&& $eventfadetime (< $event_ctime $eventfadetime)) [
                    event_growth = (-f 1 (divf $event_ctime $eventfadetime))
                    event_blend = (clampf (*f $event_growth $eventblend) 0 1)
                    event_dir = -1
                ] [
                    event_blend = 0
                    event_growth = 0
                ]
            ] (&& $eventintime (< $event_millis $eventintime)) [
                event_growth = (divf $event_millis $eventintime)
                event_blend = (clampf (*f $event_growth $eventblend) 0 1)
                event_dir = 1
            ]
            if (>f $event_growth 0.0) [
                local event_clients; event_clients = (geteventtaggroups $event_id "client")
                local event_colour; event_colour = 0
                loopwhile event_clidx $event_clients [! $event_colour] [
                    event_clientid = (geteventtag $event_id "client" $event_clidx "clientnum")
                    if (= $focusedplayer $event_clientid) [ event_colour = 0x202010 ]
                ]
                local event_concolour; event_concolour = (geteventlist $event_id "args" "colour")
                if (! $event_concolour) [ event_concolour = 0xFFFFFF ]
                local event_obj
                event_obj = [
                    uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                    uitext (geteventlist $event_id "args" "console") $ui_texttiny [
                        uistyle leftmiddle
                        uitextalign -1
                        uicolourset $event_concolour
                    ]
                ]
                local event_type; event_type = (geteventlist $event_id "args" "type")
                local event_action; event_action = (geteventlist $event_id "args" "action")
                if (= $showevents 2) [
                    cases $event_type "game" [
                        if (! $event_colour) [ event_colour = 0x202020 ]
                        cases $event_action "music" [
                            event_obj = [
                                uiimage "<grey>textures/icons/edit/sound" 0xFFFFFF 0 0 $ui_hud_texttiny [
                                    uistyle leftmiddle
                                    uiimageaspect 1
                                    uiimageshadow 0.001 0x20202020 1
                                ]
                                local event_title; event_title = (geteventlist $event_id "args" "title")
                                uitext $event_title $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                    uicolourset $colourdarkmagenta
                                ]
                                local event_artist; event_artist = (geteventlist $event_id "args" "artist")
                                if (!=s $event_artist "") [
                                    uitext "by" $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                    uitext $event_artist $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        uicolourset $colourdarkmagenta
                                    ]
                                ]
                            ]
                        ]
                    ] "match" [
                        if (! $event_colour) [ event_colour = 0x202020 ]
                        cases $event_action "start" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (gamename $gamemode $mutators 0 64) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                    uicolourset $colouryellow
                                ]
                                uitext "on" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uitext (getmaptitle $mapname) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                    uicolourset $colourorange
                                ]
                            ]
                        ] "overtime" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Overtime" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_time; event_time = (geteventlist $event_id "args" "limit")
                                caseif (> $event_time 0) [
                                    uitext "Match extended" $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                    uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    uitext (timestr $event_time $showtimestyle) $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        uicolourset $colourcyan
                                    ]
                                ] (< $event_time 0) [
                                    uitext "Winner decided" $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] () [
                                    uitext "Next point wins" $$ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                            ]
                        ] "timelimit" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Time limit reached" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "oneminute" [
                            event_obj = [
                                uiimage $waitingtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "One minute remaining" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "scorelimit" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Score limit reached" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "scorereach" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Best score achieved" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "secured" [
                            event_obj = [
                                uiimage $winnertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                if (& $mutators (<< 1 $G_M_FFA)) [
                                    uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] [
                                    uitext (getteamname (geteventtag $event_id "winner" 0 "team")) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                                uitext "secured all points" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "draw" [
                            event_obj = [
                                uiimage $winnertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_extra; event_extra = 0
                                if (& $mutators (<< 1 $G_M_FFA)) [
                                    loopeventgroups $event_id "client" 0 0 event_winner [
                                        if $event_extra [
                                            uitext "+" $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                                uicolourset $colourgrey
                                            ]
                                        ]
                                        uitext (geteventname $event_id "client" $event_winner) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ] [
                                    loopeventgroups $event_id "winner" 0 0 event_winner [
                                        if $event_extra [
                                            uitext "+" $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                                uicolourset $colourgrey
                                            ]
                                        ]
                                        uitext (getteamname (geteventtag $event_id "winner" $event_winner "team")) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                uitext "tied the match" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                if (&& (= $gamemode $G_RACE) (& $mutators (<< 1 $G_M_GSP1))) [
                                    uitext (timestr (geteventlist $event_id "args" "score") $scoreracestyle) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        uicolourset $colourcyan
                                    ]
                                ] [
                                    local event_score; event_score = (geteventlist $event_id "args" "score")
                                    uitext $event_score $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        uicolourset $colourcyan
                                    ]
                                    uitext (? (!= $event_score 1) "points" "point") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                            ]
                        ] "winner" [
                            event_obj = [
                                uiimage $winnertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                if (& $mutators (<< 1 $G_M_FFA)) [
                                    uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] [
                                    uitext (getteamname (geteventtag $event_id "winner" 0 "team")) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                                uitext "won the match" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                if (&& (= $gamemode $G_RACE) (& $mutators (<< 1 $G_M_GSP1))) [
                                    uitext (timestr (geteventlist $event_id "args" "score") $scoreracestyle) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        uicolourset $colourcyan
                                    ]
                                ] [
                                    local event_score; event_score = (geteventlist $event_id "args" "score")
                                    uitext $event_score $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                        uicolourset $colourcyan
                                    ]
                                    uitext (? (!= $event_score 1) "points" "point") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                            ]
                        ]
                    ] "balance" [
                        if (! $event_colour) [ event_colour = 0x102828 ]
                        cases $event_action "warning" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (concatword "Team balance in ^fs^fc" (timestr (geteventlist $event_id "args" "millis") 4) "^fS") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "success" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Team balance ^fs^fccompleted^fS" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "failure" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Team balance ^fs^fcfailed^fS" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "lapse" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Team balance no longer required" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "unable" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "Team balance unable to be performed" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "swap" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_force; event_force = (geteventlist $event_id "args" "forcebal")
                                uitext (concatword (? $event_force "Role switch" "Symmetry swap") " in ^fs^fc" (timestr (geteventlist $event_id "args" "millis") 4) "^fS") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "swapped" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_force; event_force = (geteventlist $event_id "args" "forcebal")
                                uitext (concatword (? $event_force "Role switch" "Symmetry swap") " completed") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ] "team" [
                        if (! $event_colour) [ event_colour = 0x102828 ]
                        cases $event_action "request" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (concatword "Moved to " (getteamname (geteventlist $event_id "args" "team")) " as previously requested") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "moved" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (concatword "Moved to " (getteamname (geteventlist $event_id "args" "team")) " by " (geteventname $event_id "client" 1)) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "swap" [
                            event_obj = [
                                uiimage $infotex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (concatword (geteventname $event_id "client" 0) " requests swap to " (getteamname (geteventlist $event_id "args" "team"))) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ] "frag" [
                        if $eventobitclassic [
                            event_obj = [
                                uiimage $deadtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (geteventlist $event_id "args" "console") $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                    uicolourset $event_concolour
                                ]
                            ]
                        ] [
                            event_obj = [
                                uiimage $deadtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_self; event_self = (= (geteventtag $event_id "client" 0 "clientnum") (geteventtag $event_id "client" 1 "clientnum"))
                                local event_extra; event_extra = 0
                                local event_textsize; event_textsize = $ui_texttiny
                                loopeventgroups $event_id "client" 0 0 event_client [
                                    if $event_client [
                                        if $event_extra [
                                            uitext "+" $event_textsize [
                                                uistyle leftmiddle
                                                uitextalign -1
                                                uicolourset $colourgrey
                                            ]
                                        ]

                                        uitext (geteventname $event_id "client" $event_client) $event_textsize [
                                            uistyle leftmiddle
                                            uitextalign -1
                                            if $event_extra [ uicolourscale 0xA0A0A0 ]
                                        ]

                                        if (! $event_extra) [
                                            event_extra = 1
                                            event_textsize = (*f $ui_texttiny 0.75)
                                        ]
                                    ]
                                ]

                                local event_weap; event_weap = (geteventlist $event_id "args" "weapon")
                                if (>= $event_weap 0) [
                                    local event_weapon; event_weapon = (at $W_NAMES $event_weap)
                                    uiimage $[@[event_weapon]tex] $[@[event_weapon]colour] 0 0 $ui_hud_texttiny [
                                        uistyle leftmiddle
                                        uiimageaspect 1
                                        local event_actflags; event_actflags = (geteventlist $event_id "args" "actflags")
                                        if (& $event_actflags $HIT_ALT) [
                                            uiimageshadow 0.001 0x01FF0000 1
                                        ] [
                                            uiimageshadow 0.001 0x0100FF00 1
                                        ]
                                    ]
                                ] [
                                    if (geteventlist $event_id "args" "burning") [
                                        uiimage $burntex (getclientrescolour $focusedplayer $PULSE_BURN) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    ]
                                    if (geteventlist $event_id "args" "bleeding") [
                                        uiimage $bleedtex (getclientrescolour $focusedplayer $PULSE_BLEED) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    ]
                                    if (geteventlist $event_id "args" "shocking") [
                                        uiimage $shocktex (getclientrescolour $focusedplayer $PULSE_SHOCK) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    ]
                                ]

                                local event_context; event_context = (geteventlist $event_id "args" "context")
                                if (!=s $event_context "") [
                                    uitext $event_context (*f $ui_texttiny 0.75) [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]

                                if $event_self [
                                    uiimage $warningtex (getclientrescolour $focusedplayer $PULSE_WARN) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                ] [
                                    if (&& (! (& $mutators (<< 1 $G_M_FFA))) (= (geteventtag $event_id "client" 0 "team") (geteventtag $event_id "client" 1 "team"))) [
                                        uiimage $warningtex (getclientrescolour $focusedplayer $PULSE_WARN) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    ]

                                    uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]

                                local event_style; event_style = (geteventlist $event_id "args" "style")
                                if $event_style [
                                    if (& $event_style $FRAG_HEADSHOT) [
                                        uiimage $headshottex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_REVENGE) [
                                        uiimage $revengetex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_DOMINATE) [
                                        uiimage $dominatetex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_BREAKER) [
                                        uiimage $breakertex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_MKILL1) [
                                        uiimage $multi1tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_MKILL2) [
                                        uiimage $multi2tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_MKILL3) [
                                        uiimage $multi3tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_FIRSTBLOOD) [
                                        uiimage $firstbloodtex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_SPREE1) [
                                        uiimage $spree1tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_SPREE2) [
                                        uiimage $spree2tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_SPREE3) [
                                        uiimage $spree3tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]

                                    if (& $event_style $FRAG_SPREE4) [
                                        uiimage $spree4tex 0xFFFFFF 0 0 $ui_hud_texttiny [
                                            uistyle leftmiddle
                                            uiimageaspect 1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ] "duel" [
                        if (! $event_colour) [ event_colour = 0x202020 ]
                        cases $event_action "start" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                if (&& (& $mutators (<< 1 $G_M_SURVIVOR)) (> $event_clients 4)) [
                                    uitext (concatword "Survivor with ^fs^fc" $event_clients "^fS players") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] [
                                    local event_extra; event_extra = 0
                                    loopeventgroups $event_id "client" 0 0 event_client [
                                        if $event_extra [
                                            uitext "vs." $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                                uicolourset $colourgrey
                                            ]
                                        ]
                                        uitext (geteventname $event_id "client" $event_client) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_desc; event_desc = (? (geteventlist $event_id "args" "sudden") "SUDDEN DEATH" (format "Round %1" (geteventlist $event_id "args" "round")))
                                uitext $event_desc $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "draw" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "All players fragged" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $deadtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext "EPIC FAIL" $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ] "score" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                if (&& (& $mutators (<< 1 $G_M_SURVIVOR)) (! (& $mutators (<< 1 $G_M_FFA)))) [
                                    local event_team; event_team = (geteventlist $event_id "args" "winner")
                                    if (> (geteventtaggroups $event_id "alive") 4) [
                                        uitext (concat "Team" (getteamname $event_team)) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        uiimage $winnertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    ] [
                                        local event_extra; event_extra = 0
                                        loopeventgroups $event_id "alive" 0 0 event_client [
                                            if $event_extra [
                                                uitext "+" $ui_texttiny [
                                                    uistyle leftmiddle
                                                    uitextalign -1
                                                    uicolourset $colourgrey
                                                ]
                                            ]
                                            uitext (geteventname $event_id "alive" $event_client) $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                            ]
                                            event_extra = 1
                                        ]
                                        uiimage $winnertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    ]
                                ] [
                                    uitext (geteventname $event_id "alive" 0) $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                    uiimage $winnertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                ]
                                local event_dead; event_dead = (geteventtaggroups $event_id "dead")
                                if (> $event_dead 4) [
                                    uitext (concatword "^fs^fc" $event_dead "^fS / ^fs^fc" $event_clients "^fS fragged") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ] [
                                    event_extra = 0
                                    loopeventgroups $event_id "dead" 0 0 event_client [
                                        if $event_extra [
                                            uitext "+" $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                            ]
                                        ]
                                        uitext (geteventname $event_id "dead" $event_client) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                if (! (& $mutators (<< 1 $G_M_INSTAGIB))) [
                                    local event_flawless; event_flawless = (geteventlist $event_id "args" "flawless")
                                    uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    if $event_flawless [
                                        uitext "Flawless victory!" $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                    ] [
                                        local event_health; event_health = (divf (geteventlist $event_id "args" "health") $damagedivisor)
                                        if $damageinteger [ event_health = (toint (ceil $event_health)) ] [ event_health = (precf $event_health 1) ]
                                        uitext (concatword "^fs^fc" $event_health "^fS health left") $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                    ]
                                ]
                                local event_wins; event_wins = (geteventlist $event_id "args" "wins")
                                if (> $event_wins 1) [
                                    uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                    uitext (concatword "^fs^fc" $event_wins "^fS in succession") $ui_texttiny [
                                        uistyle leftmiddle
                                        uitextalign -1
                                    ]
                                ]
                            ]
                        ]
                    ] "bomber" [
                        if (! $event_colour) [ event_colour = 0x202020 ]
                        cases $event_action "secure" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $bombtakentex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "drop" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $bombdroptex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "score" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_goal; event_goal = (geteventlist $event_id "args" "goal")
                                local event_team; event_team = (getbomberteam $event_goal)
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $pointtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "reset" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_rtex; event_rtex = (? (= (geteventlist $event_id "args" "value") 2) "<grey>textures/icons/edit/redo" $pointtex)
                                uiimage $event_rtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "start" [
                            event_obj = [
                                uiimage $modebombertex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $bombtex (getclientrescolour $focusedplayer $PULSE_DISCO) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $pointtex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ]
                    ] "capture" [
                        if (! $event_colour) [ event_colour = 0x202020 ]
                        cases $event_action "secure" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $flagtakentex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "return" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $pointtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "drop" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $flagdroptex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "score" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                local event_goal; event_goal = (geteventlist $event_id "args" "goal")
                                local event_base; event_base = (getcaptureteam $event_goal)
                                uitext (geteventname $event_id "client" 0) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $pointtex (getteamcolour $event_base) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ] "reset" [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_flag; event_flag = (geteventlist $event_id "args" "affinity")
                                local event_team; event_team = (getcaptureteam $event_flag)
                                uiimage $flagtex (getteamcolour $event_team) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_rtex; event_rtex = $pointtex
                                local event_rcol; event_rcol = (getteamcolour $event_team)
                                if (= (geteventlist $event_id "args" "value") 2) [
                                    event_rtex = "<grey>textures/icons/edit/redo"
                                    event_rcol = 0xFFFFFF
                                ]
                                uiimage $event_rtex $event_rcol 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                            ]
                        ]
                    ] "defend" [
                        if (! $event_colour) [ event_colour = 0x202020 ]
                        if (|| (=s $event_action "secure") (=s $event_action "overthrow")) [
                            event_obj = [
                                uiimage (modetex) 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                local event_extra; event_extra = 0
                                loop event_attackid $event_clients [
                                    if (= (geteventtag $event_id "client" $event_attackid "team") (geteventlist $event_id "args" (? (=s $event_action "secure") "owner" "enemy"))) [
                                        if $event_extra [
                                            uitext "+" $ui_texttiny [
                                                uistyle leftmiddle
                                                uitextalign -1
                                            ]
                                        ]
                                        uitext (geteventname $event_id "client" $event_attackid) $ui_texttiny [
                                            uistyle leftmiddle
                                            uitextalign -1
                                        ]
                                        event_extra = 1
                                    ]
                                ]
                                uiimage $pointtex (getteamcolour (geteventlist $event_id "args" "oldowner")) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $arrowrighttex 0xFFFFFF 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uiimage $pointtex (getteamcolour (geteventlist $event_id "args" "owner")) 0 0 $ui_hud_texttiny [ uistyle leftmiddle; uiimageaspect 1; uiimageshadow 0.001 0x20202020 1 ]
                                uitext (getdefendname (geteventlist $event_id "args" "affinity")) $ui_texttiny [
                                    uistyle leftmiddle
                                    uitextalign -1
                                ]
                            ]
                        ]
                    ]
                ]
                uitag (concatword "event_" $event_time "_" (geteventseqid $event_id)) [
                    uipad 0 0 0 (*f $ui_padsmaller $event_growth) [
                        uistyle lefttop
                        ui_hud_skin (? $event_colour $event_colour 0x000000) 0 0 [ uistyle lefttop ] [
                            uistyle lefttop
                            uiclip 0 0 0 0 [
                                uistyle lefttop
                                uiclipforced 1
                                uispace $ui_padsmall $ui_padsmaller [
                                    uistyle lefttop
                                    uihlist $ui_padsmall [
                                        uistyle leftmiddle
                                        @event_obj
                                    ]
                                ]
                                case $event_dir 1 [
                                    uiclipoffsetx (*f $uilastwprev (-f 1.0 $event_growth))
                                    uiclipoffsety 0
                                    uiclipsizew (*f $uilastwprev $event_growth)
                                    uiclipsizeh $uilasthprev
                                ] -1 [
                                    uiclipoffsetx 0
                                    uiclipoffsety (*f $uilasthprev (-f 1.0 $event_growth))
                                    uiclipsizew $uilastwprev
                                    uiclipsizeh (*f $uilasthprev $event_growth)
                                ] () [
                                    uiclipoffsetx 0
                                    uiclipoffsety 0
                                    uiclipsizew $uilastwprev
                                    uiclipsizeh $uilasthprev
                                ]
                            ]
                        ] (*f $eventskinspace $event_growth) $eventskin $eventskinblend
                        uipropagate [ uicolourblend $event_blend ]
                    ]
                ]
            ]
        ]
    ]
]