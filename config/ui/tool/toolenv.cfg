ui_tool_env_param_interval = (? (isonline) 250 0)

// 1:<text> 2:<contents>
ui_tool_env_param_group = [
    uitablerow [
        uiclamp 1 1
        uipad 0 $ui_tool_elem_space_xl 0 0 [
            uitext $arg1 $ui_tool_text_size_s
        ]
        uialign- -1
        @arg2
    ]
    uifill 0 $ui_tool_elem_space_s
    uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]
    uifill 0 $ui_tool_elem_space_s
]

# ui_tool_env_skybox [
    result [
        uivlist 0 [
            ui_tool_skyboxselect skybox#1 arg1

            ui_tool_numinput skyblend#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Blend")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput skyoverbright#1 arg1 1 16 0.5 [
                uit_label = [#1(? $arg1 "" "Overbright")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput yawsky#1 arg1 0 360 1 [
                uit_label = [#1(? $arg1 "" "Yaw")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
                uit_val_format = i
                uit_circular = 1
            ]

            ui_tool_numinput pitchsky#1 arg1 0 360 1 [
                uit_label = [#1(? $arg1 "" "Pitch")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
                uit_val_format = i
                uit_circular = 1
            ]

            ui_tool_numinput rollsky#1 arg1 0 360 1 [
                uit_label = [#1(? $arg1 "" "Roll")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
                uit_val_format = i
                uit_circular = 1
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinsky#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin yaw")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput spinskypitch#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin pitch")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput spinskyroll#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin roll")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour skycolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_skybg [
    result [
        uivlist 0 [
            ui_tool_colour skybgcolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_cloudlayer [
    result [
        uivlist 0 [
            ui_tool_imageselect cloudlayer#1 arg1 $tool_env_clouds [
                uit_tip_simple = "Click to browse cloudlayers"
            ]

            ui_tool_numinput cloudlayerblend#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Blend")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput cloudfade#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Fade")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch cloudfarplane#1 arg1 [
                uit_label = [#1(? $arg1 "" "Render")]
                uit_label_size = $ui_tool_text_size_xs
                uit_options = ["Worldspace" "Skybox"]
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_compactswitch cloudshadow#1 arg1 [
                uit_label = "Enable shadow"
            ]

            ui_tool_numinput cloudshadowblend#1 arg1 0 0 0.1 [
                uit_disabled = (! $cloudshadow#1 arg1)
                uit_label = [#1(? $arg1 "" "Shadow strength")]
                uit_label_size = $ui_tool_text_size_xs
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudheight#1 arg1 -1 1 0.1 [
                uit_label = [#1(? $arg1 "" "Height")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput cloudscale#1 arg1 1e-06 64 0.1 [
                uit_label = [#1(? $arg1 "" "Scale")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudoffsetx#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Offset X")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput cloudoffsety#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Offset Y")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudscrollx#1 arg1 -16 16 0.01 [
                uit_label = [#1(? $arg1 "" "Scroll X")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput cloudscrolly#1 arg1 -16 16 0.01 [
                uit_label = [#1(? $arg1 "" "Scroll Y")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spincloudlayer#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudsubdiv#1 arg1 4 64 1 [
                uit_label = [#1(? $arg1 "" "Subdivision")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour cloudlayercolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_envlayer [
    result [
        uivlist 0 [
            ui_tool_imageselect envlayer#1 arg1 $tool_env_clouds [
                uit_tip_simple = "Click to browse cloudlayers"
            ]

            ui_tool_numinput envlayerblend#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Blend")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput envfade#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Fade")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch envfarplane#1 arg1 [
                uit_label = [#1(? $arg1 "" "Render")]
                uit_label_size = $ui_tool_text_size_xs
                uit_options = ["Worldspace" "Skybox"]
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_compactswitch envshadow#1 arg1 [
                uit_label = "Enable shadow"
            ]

            ui_tool_numinput envshadowblend#1 arg1 0 0 0.1 [
                uit_disabled = (! $envshadow#1 arg1)
                uit_label = [#1(? $arg1 "" "Shadow strength")]
                uit_label_size = $ui_tool_text_size_xs
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envheight#1 arg1 -1 1 0.1 [
                uit_label = [#1(? $arg1 "" "Height")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput envscale#1 arg1 1e-06 64 0.1 [
                uit_label = [#1(? $arg1 "" "Scale")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envoffsetx#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Offset X")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput envoffsety#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Offset Y")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envscrollx#1 arg1 -16 16 0.01 [
                uit_label = [#1(? $arg1 "" "Scroll X")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput envscrolly#1 arg1 -16 16 0.01 [
                uit_label = [#1(? $arg1 "" "Scroll Y")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinenvlayer#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envsubdiv#1 arg1 4 64 1 [
                uit_label = [#1(? $arg1 "" "Subdivision")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour envlayercolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_cloudbox [
    result [
        uivlist 0 [
            ui_tool_skyboxselect cloudbox#1 arg1

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudblend#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Blend")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput cloudclip#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Clip")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinclouds#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin yaw")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput spincloudspitch#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin pitch")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput spincloudsroll#1 arg1 -720 720 0.5 [
                uit_label = [#1(? $arg1 "" "Spin roll")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour cloudcolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_atmo [
    result [
        uivlist 0 [
            ui_tool_checkbox atmo#1 arg1 [
                uit_label_size = $ui_tool_text_size_xs
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch atmo#1 arg1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Order")]
                uit_options = ["Front" "Back"]
                uit_get = [ = $arg1 2 ]
                uit_set = [ at [ 2 1 ] (- $arg1 1) ]
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmoblend#1 arg1 0 1 0.1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Blend")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput atmobright#1 arg1 0 1 0.1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Brightness")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmodensity#1 arg1 0 1 0.1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Density")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput atmohaze#1 arg1 0 100 0.1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Scattering")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput atmoheight#1 arg1 1e-06 1000000 0.1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Thickness")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput atmoozone#1 arg1 0 100 1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Ozone")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmoplanetsize#1 arg1 0.01 1000000 1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Planet size")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmolightscale#1 arg1 0 16 1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Tint scale")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour atmolight#1 arg1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
                uit_flags = $TOOL_COLOUR_ZEROFIX
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_atmo_disk [
    result [
        uivlist 0 [
            ui_tool_numinput atmodisksize#1 arg1 0 90 1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Size")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput atmodiskbright#1 arg1 0 16 1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Brightness")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput atmodiskcorona#1 arg1 0 1 0.1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Corona")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour atmodisk#1 arg1 [
                uit_disabled = @(! $atmo#1 arg1)
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
                uit_flags = $TOOL_COLOUR_ZEROFIX
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_fog [
    result [
        uivlist 0 [
            ui_tool_numinput fog#1 arg1 16 10000024 100 [
                uit_label = [#1(? $arg1 "" "Distance")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour fogcolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
                uit_flags = $TOOL_COLOUR_ZEROFIX
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_fogdome [
    result [
        uivlist 0 [
            uihlist $ui_tool_elem_space_s [
                ui_tool_checkbox fogdomecap#1 arg1 [
                    uit_label_size = $ui_tool_text_size_xs
                    uit_label = "Cap"
                ]

                ui_tool_checkbox fogdomeclouds#1 arg1 [
                    uit_label_size = $ui_tool_text_size_xs
                    uit_label = "Block clouds"
                ]
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput fogdomeheight#1 arg1 -1 1 0.1 [
                uit_label = [#1(? $arg1 "" "Height")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput fogdomemin#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Min opacity")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput fogdomemax#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Max opacity")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput fogdomeclip#1 arg1 0 1 0.1 [
                uit_label = [#1(? $arg1 "" "Cut-off")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour fogdomecolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_sunlight [
    result [
        uivlist 0 [
            ui_tool_numinput sunlightyaw#1 arg1 0 360 1 [
                uit_label = [#1(? $arg1 "" "Yaw")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput sunlightpitch#1 arg1 0 360 1 [
                uit_label = [#1(? $arg1 "" "Pitch")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_button [
                uit_label = "From camera"
                uit_label_size = $ui_tool_text_size_xs
                uit_icon = "textures/icons/camera"
                uit_icon_size = 0.015
                uit_width = 0.12
                uit_on_click = [
                    sunlightyaw#1 arg1 (getcamerayaw)
                    sunlightpitch#1 arg1 (getcamerapitch)
                ]
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput sunlightscale#1 arg1 0 16 0.5 [
                uit_label = [#1(? $arg1 "" "Scale")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour sunlight#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_ambient [
    result [
        uivlist 0 [
            ui_tool_colour skylight#1 arg1 [
                uit_label = [#1(? $arg1 "" "Skylight")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_colour ambient#1 arg1 [
                uit_label = [#1(? $arg1 "" "Ambient")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_hdr [
    result [
        uivlist 0 [
            ui_tool_numinput hdrbright#1 arg1 0.001 1000 0.5 [
                uit_label = [#1(? $arg1 "" "Brightness")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_gi [
    result [
        uivlist 0 [
            ui_tool_numinput giscale#1 arg1 0 1000 0.5 [
                uit_label = [#1(? $arg1 "" "Scale")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput giaoscale#1 arg1 0 1000 1 [
                uit_label = [#1(? $arg1 "" "AO scale")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput gidist#1 arg1 0 1024 64 [
                uit_label = [#1(? $arg1 "" "Distance")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_ao [
    result [
        uivlist 0 [
            ui_tool_numinput aodark#1 arg1 0.001 1000 0.5 [
                uit_label = [#1(? $arg1 "" "Strength")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput aomin#1 arg1 0 1 0.05 [
                uit_label = [#1(? $arg1 "" "Min.")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput aoradius#1 arg1 0 256 1 [
                uit_label = [#1(? $arg1 "" "Radius")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput aosharp#1 arg1 0.001 1000 0.5 [
                uit_label = [#1(? $arg1 "" "Sharpening")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_checkbox aosun#1 arg1 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Sunlight")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput aosunmin#1 arg1 0 1 0.05 [
                uit_disabled = @(! $aosun#1 arg1)
                uit_label = [#1(? $arg1 "" "Min. in sunlight")]
                uit_label_size = $ui_tool_text_size_xs
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_haze [
    result [
        uivlist 0 [
            ui_tool_checkbox haze#1 arg1 [
                uit_label_size = $ui_tool_text_size_xs
            ]

            ui_tool_numinput hazeblend#1 arg1 0 0 0.1 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Blend")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour hazecolour#1 arg1 [
                uit_label = [#1(? $arg1 "" "Colour")]
                uit_label_size = $ui_tool_text_size_xs
                uit_val_format = i
                uit_interval = $ui_tool_env_param_interval
                uit_flags = $TOOL_COLOUR_ZEROFIX
            ]

            ui_tool_numinput hazecolourmix#1 arg1 0 0 0.1 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Colour mix")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazemindist#1 arg1 0 0 10 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Min distance")]
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput hazemaxdist#1 arg1 0 0 100 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Max distance")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazerefract#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Refract small")]
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput hazerefract3#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Refract medium")]
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput hazerefract2#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Refract large")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazescalex#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Scale X")]
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput hazescaley#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Scale Y")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazescrollx#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Scroll X")]
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput hazescrolly#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Scroll Y")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_fileselect hazetex#1 arg1 [
                uit_file_type = $TOOL_FILE_IMAGE
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazemargin#1 arg1 0 0 1 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Margin")]
                uit_interval = $ui_tool_env_param_interval
            ]

            uiclamp 1 1
            uialign* 1
            uialign 1
        ]
    ]
]

# ui_tool_env_wind [
    result [
        uivlist 0 [
            ui_tool_numinput windinterval#1 arg1 0 0 1000 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Interval (ms)")]
                uit_interval = $ui_tool_env_param_interval
                uit_val_format = i
            ]

            ui_tool_numinput windspeed#1 arg1 0 0 0.5 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Speed")]
                uit_interval = $ui_tool_env_param_interval
            ]

            ui_tool_numinput windyaw#1 arg1 0 0 1 [
                uit_label_size = $ui_tool_text_size_xs
                uit_label = [#1(? $arg1 "" "Direction (yaw)")]
                uit_interval = $ui_tool_env_param_interval
                uit_circular = 1
                uit_val_format = i
            ]

            uifill 0 $ui_tool_elem_space_s

            @@(? $arg1 [] [
                ui_tool_numinput windanimdistbias 0 0 100 [
                    uit_label_size = $ui_tool_text_size_xs
                    uit_label = "Anim. cutoff bias"
                    uit_interval = $ui_tool_env_param_interval
                    uit_val_format = i
                ]
            ])

            uiclamp 1 1
            uialign* 1 -1
            uialign 1 -1
        ]
    ]
]

// 1:<ui> 2:<label>
ui_tool_env_params = [
    result [
        ui_tool_env_param_group [@@arg2] [
            @@($arg1)
            @@($arg1 alt)
        ]
    ]
]

# ui_tool_env_table [
    result [
        ui_tool_vscrollarea [
            uitable $ui_tool_elem_space_l $ui_tool_elem_space_s [
                uiclamp 1 1
                uitableheader [
                    uifill
                    uicolourtext "Normal" (? (<= $forcemapvariant 1) $ui_tool_accent_colour $ui_tool_dark_accent_colour) $ui_tool_text_size_s
                    uicolourtext "Alternative" (? (= $forcemapvariant 2) $ui_tool_accent_colour $ui_tool_dark_accent_colour) $ui_tool_text_size_s
                ]

                uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]

                #1 arg1
            ]
        ] [
            uit_height = 0.6
        ]
    ]
]

ui_tool_env_tab_skybox = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_skybox "Skybox")
        @(ui_tool_env_params ui_tool_env_skybg "Background")
    ])
]

ui_tool_env_tab_cloudlayer = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_cloudlayer "Layer #1")
        @(ui_tool_env_params ui_tool_env_envlayer "Layer #2")
    ])
]

ui_tool_env_tab_cloudbox = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_cloudbox "Cloud box")
    ])
]

ui_tool_env_tab_atmosphere = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_atmo "Atmosphere")
        @(ui_tool_env_params ui_tool_env_atmo_disk "Disk")
    ])
]

ui_tool_env_tab_fog = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_fog "Fog")
        @(ui_tool_env_params ui_tool_env_fogdome "Dome")
    ])
]

ui_tool_env_tab_lighting = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_sunlight "Sunlight")
        @(ui_tool_env_params ui_tool_env_ambient "Ambient")
        @(ui_tool_env_params ui_tool_env_hdr "HDR")
    ])
]

ui_tool_env_tab_gi = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_gi "Global illumination")
        @(ui_tool_env_params ui_tool_env_ao "Ambient occlusion")
    ])
]

ui_tool_env_tab_haze = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_haze "Haze")
    ])
]

ui_tool_env_tab_wind = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_wind "Wind")
    ])
]

tool_env_template_wizard = 0
tool_env_template_sel = 0

ui_tool_env_template = [
    ui_tool_dropdown tool_env_template_sel $tool_template_env_names [
        uit_label = "Template"
        uit_label_size = $ui_tool_text_size_xs
        uit_on_change = [
            tool_template_env_name = (at $tool_templates_env $tool_env_template_sel)
        ]
    ]

    ui_tool_switch tool_template_env_mode [
        uit_label = "Mode"
        uit_label_size = $ui_tool_text_size_xs
        uit_options = ["Day" "Night"]
        uit_get = [=s $arg1 night]
        uit_set = [? (=s $arg1 day) night day]
    ]

    ui_tool_numinput tool_template_env_time 0 1 0.1 [
        uit_label = "Time"
        uit_label_size = $ui_tool_text_size_xs
    ]

    ui_tool_numinput tool_template_env_cloudiness 0 1 0.25 [
        uit_label = "Clouds"
        uit_label_size = $ui_tool_text_size_xs
    ]

    uifill 0 $ui_tool_elem_space_xl

    uihlist $ui_tool_elem_space_s [
        uiclamp 1 1

        uitext "Apply as:" $ui_tool_text_size_s
        uialign- -1

        uihlist $ui_tool_elem_space_s [
            ui_tool_button [
                uit_label = "Primary"
                uit_width = $ui_tool_button_width_s_unscaled
                uit_on_click = [
                    tool_template_env_alt = []
                    tool_template_env_apply
                ]
            ]

            ui_tool_button [
                uit_label = "Alternative"
                uit_width = $ui_tool_button_width_s_unscaled
                uit_on_click = [
                    tool_template_env_alt = alt
                    tool_template_env_apply
                ]
            ]
        ]
        uialign- 1
    ]

    uifill 0 $ui_tool_elem_space_l
    uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]
    uifill 0 $ui_tool_elem_space_l

    ui_tool_button [
        uit_label = "Close"
        uit_width = 0.1
        uit_on_click = [
            tool_env_template_wizard = 0
        ]
    ]
    uiclamp- 1 1
]

ui_tool_env_params = [
    uihlist $ui_tool_elem_space_l [
        uitext "Load template:" $ui_tool_text_size_s
        ui_tool_button [
            uit_label = "Open wizard"
            uit_width = 0.1
            uit_on_click = [
                tool_env_template_wizard = 1
            ]
        ]
        uialign- 1
        uialign 1
    ]

    uifill 0 $ui_tool_elem_space_xl
    uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]
    uifill 0 $ui_tool_elem_space_xl

    uitext "Environment parameters" $ui_tool_text_size_s
    uialign- -1

    uifill 0 $ui_tool_elem_space_s

    ui_tool_vtabs tool_env_tabs [
        "textures/icons/edit/skybox"
        "textures/icons/edit/cloud"
        "textures/icons/edit/cloudbox"
        "textures/icons/edit/atmo"
        "textures/icons/edit/fog"
        "textures/icons/edit/light"
        "textures/icons/edit/gi"
        "textures/icons/edit/haze"
        "textures/icons/edit/wind"
    ] [
        "Skybox"
        "Cloud layers"
        "Cloud box"
        "Atmosphere"
        "Fog"
        "Lighting"
        "Global illumination"
        "Haze"
        "Wind"
    ] [
        ui_tool_env_tab_skybox
        ui_tool_env_tab_cloudlayer
        ui_tool_env_tab_cloudbox
        ui_tool_env_tab_atmosphere
        ui_tool_env_tab_fog
        ui_tool_env_tab_lighting
        ui_tool_env_tab_gi
        ui_tool_env_tab_haze
        ui_tool_env_tab_wind
    ]
]

# ui_tool_env [
    uivlist 0 [
        uiclamp 1 1

        if $tool_env_template_wizard [
            #ui_tool_env_template
        ] [
            #ui_tool_env_params
        ]
    ]
]
