defvarp progressinfo 0 1 1
defvarp progressmuts 0 1 1

progressui "default" [
    uiclamp 1 1 1 1
    uialign -1 -1
    uifont $textfontdef [
        uiclamp 1 1 1 1

        uispace $ui_padwin $ui_padwin [
            uialign -1 -1
            uivlist 0 [
                uialign -1 -1
                case $getmapstate 2 [
                    uitext "Saving..." $ui_texthuge [uialign -1 -1; uitextalign -1]
                ] 1 [
                    uitext (getmaptitle $mapname) $ui_texthuge [uialign -1 -1; uitextalign -1]
                    uispace $ui_padlarge 0 [
                        uialign -1 -1
                        uivlist 0 [
                            uialign -1 -1
                            if (!=s (getmapauthor $mapname) "") [
                                uitext (concat "by" (getmapauthor $mapname)) $ui_textlarge [uialign -1 -1; uitextalign -1; uicolourset $colourgrey]
                            ]
                        ]
                    ]
                ] 0 [
                    uitext "Loading..." $ui_texthuge [uialign -1 -1; uitextalign -1]
                ]
                //if (isconnected) [
                //    uispace 0 $ui_padnormal
                //    if (!=s $connectname "") [
                //        uitext (format "Playing on %1:[%2]" $connectname $connectport) $ui_text [uialign -1 -1; uitextalign -1; uicolourset $colourgrey]
                //        if (!=s $serverdesc "") [uitext (format "^"^fs%1^fS^"" $serverdesc) $ui_text [uialign -1 -1; uitextalign -1; uicolourset $colourgrey]]
                //    ] [
                //        uitext (format "Playing offline" $connectname $connectport) $ui_text [uialign -1 -1; uitextalign -1; uicolourset $colourgrey]
                //    ]
                //]
            ]
        ]

        uispace $ui_padwin $ui_padwin [
            uialign 1 1
            uivlist 0 [
                uialign 1 1
                if (&& $progressmuts (> (mutators) 0)) [
                    loop i $mutsidxnum [
                        local progress_mut; progress_mut = (<< 1 $i)
                        if (&& [& (mutators) $progress_mut] [! (& (mutsimplied (gamemode)) $progress_mut)]) [
                            local progress_muttxt; progress_muttxt = (mutsdesc (gamemode) $progress_mut 4)
                            if (!=s $progress_muttxt "") [
                                uitext $progress_muttxt $ui_textsmaller [uialign 1 1; uitextalign 1; uicolourset $colourgrey]
                            ]
                        ]
                    ]
                    uispace 0 $ui_padnormal
                ]
                uitext (gamename (gamemode) (mutators) 0 32) $ui_textextralarge [uialign 1 1; uitextalign 1; uicolourset $colouryellow]
                uitext (modedesc (gamemode) (mutators) 5) $ui_text [uialign 1 1; uitextalign 1]
            ]
        ]

        uispace $ui_padwin $ui_padwin [
            uialign 1 -1
            uivlist 0 [
                uialign 1 -1
                uiimage $logotex 0xFFFFFF 1 0.23 0.115 [uialign 1 -1]
                //local progress_modetexs; progress_modetexs = (modetexlist (gamemode) (mutators))
                //if (!=s $progress_modetexs "") [
                //    if $progressmuts [
                //        looplist progress_modetex $progress_modetexs [
                //            uiimage $progress_modetex $ui_default 0 $ui_imgtitle $ui_imgtitle [uialign 1 -1; uiimageshadow $ui_menu_s]
                //        ]
                //    ] [
                //        local progress_modetex; progress_modetex = (at $progress 0)
                //        uiimage $progress_modetex $ui_default 0 $ui_imgtitle $ui_imgtitle [uialign 1 -1; uiimageshadow $ui_menu_s]
                //    ]
                //]
            ]
        ]

        uispace $ui_padwin $ui_padwin [
            uialign -1 1
            uivlist $ui_padsmall [
                uialign -1 1
                uitext (tipshow) $ui_text [uialign -1 0; uitextalign -1]
                uihlist 0 [
                    uialign -1 1
                    if (>f $progressamt 0) [
                        uihmetera $progressamt $ui_buttonzq $ui_buttonzh $colourdarkred $ui_menu $ui_disa [@colourred] [] -1
                    ] [
                        uihthroba (divf (mod (getmillis -1) 1000) 1000) $ui_buttonzq $ui_buttonzh $colourdarkred $ui_menu $ui_disa [@colourred]
                    ]
                    uispace $ui_padsmall 0
                    if $progressinfo [
                        local ui_progress_title; ui_progress_title = (getprogresstitle)
                        if (!=s $ui_progress_title "") [
                            uispace $ui_padsmall 0 [
                                uialign -1 1
                                uitext $ui_progress_title $ui_text [uialign -1 0; uitextalign -1]
                            ]
                        ]
                    ]
                ]
            ]
        ]
    ]
] [] [] 16
